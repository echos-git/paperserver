name: Update Geyser & Floodgate

on:
  schedule:
    - cron: "0 * * * *"   # hourly
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Download latest Geyser
        run: |
          curl -s https://api.github.com/repos/GeyserMC/Geyser/releases/latest \
          | jq -r '.assets[] | select(.name | contains("spigot")) | .browser_download_url' \
          | xargs curl -L -o Geyser-Spigot.jar

      - name: Download latest Floodgate
        run: |
          curl -s https://api.github.com/repos/GeyserMC/Floodgate/releases/latest \
          | jq -r '.assets[] | select(.name | contains("spigot")) | .browser_download_url' \
          | xargs curl -L -o Floodgate-Spigot.jar

      - name: Upload via SFTP
        uses: appleboy/scp-action@v0.1.7
        with:
          host: ${{ secrets.SFTP_HOST }}
          port: ${{ secrets.SFTP_PORT }}
          username: ${{ secrets.SFTP_USER }}
          password: ${{ secrets.SFTP_PASS }}
          source: "Geyser-Spigot.jar,Floodgate-Spigot.jar"
          target: ${{ secrets.SFTP_PATH }}
          overwrite: true
